let server;"serviceWorker"in navigator&&navigator.serviceWorker.register("serviceWorker.js").then(()=>{console.log("Service Worker Registered")});const displayData=()=>{const list=document.querySelector(".stored");list.innerHTML="",server.data.query().all().execute().then(results=>{results.length?results.forEach(item=>{const reader=new FileReader;list.innerHTML+=`\n\t\t\t\t\t\t<li data-id="${item.id}">\n\t\t\t\t\t\t\t<p class="item-icon"><img /></p>\n\t\t\t\t\t\t\t<p class="item-name">${item.text}</p>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<p class="item-date">${item.date}</p>\n\t\t\t\t\t\t\t\t<p class="item-price">${item.number}$</p>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<aside class="item-edit">Edit</aside>\n\t\t\t\t\t\t\t\t<aside class="item-delete">Delete</aside>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t`,reader.addEventListener("load",()=>{document.querySelector('li[data-id="'+item.id+'"] img').src=reader.result}),item.file&&reader.readAsDataURL(item.file),document.querySelector('li[data-id="'+item.id+'"] aside.item-edit').addEventListener("click",()=>{console.log("edit"),editItem(item)}),document.querySelector('li[data-id="'+item.id+'"] aside.item-delete').addEventListener("click",()=>{deleteItem(item)})}):list.innerHTML="\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<p>No item stored</p>\n\t\t\t\t\t</li>\n\t\t\t\t"})},editItem=item=>{const formSection=document.querySelector(".edit-item"),form=formSection.querySelector("form");document.querySelector(".add-item").classList.remove("running"),form.elements.id.value=item.id,form.elements.text.value=item.text,form.elements.number.value=item.number,form.elements.date.value=item.date,form.querySelector("img").replaceWith(document.querySelector('li[data-id="'+item.id+'"] .item-icon img').cloneNode()),form.querySelector("img").addEventListener("click",e=>{e.target.nextElementSibling.click()}),formSection.classList.add("active")},deleteItem=item=>{server.data.remove(item.id).then(()=>{document.querySelector('li[data-id="'+item.id+'"]').remove()})};window.addEventListener("load",()=>{db.open({server:"test-data-storing",version:1,schema:{data:{key:{keyPath:"id",autoIncrement:!0},indexes:{text:{},number:{},date:{},file:{}}}}}).then(s=>{server=s,displayData()});const addButton=document.querySelector(".add-item");addButton.addEventListener("click",e=>{const editSection=document.querySelector(".edit-item");addButton.classList.add("running"),editSection.classList.add("active"),editSection.querySelector("form").reset(),editSection.querySelector("img").src="",editSection.querySelector('input[name="id"]').value=""});const form=document.querySelector("form");form.querySelector("img").addEventListener("click",e=>{e.target.nextElementSibling.click()}),form.elements.file.addEventListener("change",()=>{if(form.elements.file.files&&form.elements.file.files[0]){const reader=new FileReader;reader.addEventListener("load",e=>{form.querySelector("img").src=e.target.result}),reader.readAsDataURL(form.elements.file.files[0])}}),document.querySelector("form").addEventListener("submit",e=>{e.preventDefault();let data=[...new FormData(e.target)].reduce((acc,[key,value])=>(acc[key]=value,acc),{});delete data.id,server.data.add(data).then(()=>{displayData(),addButton.classList.remove("running"),form.reset(),document.querySelector(".edit-item").classList.remove("active")})})});